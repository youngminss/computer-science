# IP

### 정의

**IP(Internet Protocol) **

+ TCP 세그먼트가 만들어지면 다음은 IP처리가 시작된다.
+ IP에는 프로토콜 종류에 따라 다른 버젼이 있다.
+ 현재 폭넓게 사용도고 있는 것은 IPv4
+ 최근에는 새로운 버전인 IPv6도 사용되지만, 대부분 기업형 시스템 등에서는 아직 IPv4를 사용한다.
+ 이는, 상호 호환성 문제때문인데, IPv4 와 IPv6 명칭은 비슷하지만, 상호 호환성때문에, 기존에 IPv4 체계였던, 대부분의 시스템들이 당장 IPv6로 옮길 수 없는 것이다.

### IP 역할

> 지정한 대상 서버까지 전달받은 데이터를 전해 주는 것

+ 간단하지만, TCP/IP에서 가장 중요한 기능임
+ **단, IP에서는 반드시 데이터가 전달된다고 보장하지 않는다.**

### IP 기능

+ **IP 주소를 이용, 최종 목적지에 데이터 전송**
+ **라우팅(Routing)**

### 커널 공간의 IP처리 흐름

IP를 통한 데이터 전송과정 전에, IP 계층에 전달된, TCP 세그먼트가 어떻게 처리되는지 살펴보자.

+ 생성된 TCP 세그먼트는 그대로 IP 처리에 돌입한다.
+ IP 계층에서는, 최종 목적지가 적힌 IP 헤더를 TCP 세그먼트에 추가해서 IP 패킷을 생성한다.
+ IP 헤더에는 목적지 IP 주소 외에, 데이터 길이, 프로토콜 종류(TCP 등), 헤더 체크섬 등이 기록된다.

![](https://img1.daumcdn.net/thumb/R800x0/?scode=mtistory2&fname=https%3A%2F%2Ft1.daumcdn.net%2Fcfile%2Ftistory%2F1254CD0D49CCC0CE05)

정리하자면

+** IP 패킷 = IP 헤더 + TCP 세그먼트 **

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FcWquju%2Fbtq1JWQGxUj%2FHgrSGSGK97BwWlLIGHTAS1%2Fimg.png)

IP 내용으로 돌아와서, 기본적으로 IP 패킷은 TCP에 의해 링크 계층에서 최대 전송 크기로 분할돼 있기 때문에, 여기에 IP 헤더만 추가한 것이다.

+ 참고로, TCP 헤더 = 20 Byte 고 IP 헤더도 = 20Byte 이다.
+ 그래서, 기본적으로, IP 패킷은 실제로는 최대 크기가 1460(MSS) + 20 + 20 = 1500 Byte이다.

3000Byte 데이터가 있다면

+ 전체데이터 = 패킷1(1500Byte) + 패킷2(1500Byte) + 패킷3(100Byte) 일 것이다.

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbeO7rM%2Fbtq1Mq4nhO0%2FKtspT0onI8715USKTq3AVk%2Fimg.png)

### IP 주소를 이용한 최종 목적지까지 데이터 전송

> IP 에서는 최종 목적지 서버까지 복수의 네트워크를 경우해서 데이터를 전송한다.

+ 이때, 사용되는 것이 서버를 나타내는 IP 주소다.
+ IP 주소는 **32 bit(4 Byte)**로 표현된 숫자 집합
+ 컴퓨터에서 처리하는 숫자니까, 원래는 이진수를 써야 한다.
+ 하지만, 사람이 읽기 쉽도록 192.168.0.1 같은 8비트(2^8 = 0 ~ 255) 단위로 마침표를 찍어서 표현한다.

**네트워크부 / 호스트부**

![](https://juner417.github.io/assets/post_images/2018-03-23-network-101-ip-subnet/ip-address.png)

> IP 주소는 네트워크부와 호스트부로 나뉜다.

+ 네트워크부 : 어떤 네트워크인지를 가리킨다.
+ 호스트부 : 해당 네크워크 내에 있는 PC를 가리킨다.

> 즉, IP로 `어디에`, `누구` 인지를 알 수 있다.

**CIDR(사이더) 표기**

+ 이때, IP 주소에서 어디까지가 네트워크부이고, 호스트부 인지를 표시하기 위해 "/24" 와 같은 표기를 사용
+ 다른 표현으로, `서브넷 마스크(Subnet Mask)`라고 해서, 255.255.255.0 과 같이 표현하기도 한다.

![](https://juner417.github.io/assets/post_images/2018-03-23-network-101-ip-subnet/subnet.png)

> 같은 네트워크 내 PC의 IP 주소는 네트워크부를 동일 값으로 설정해야한다.

![](https://img1.daumcdn.net/thumb/R720x0.q80/?scode=mtistory2&fname=http%3A%2F%2Fcfile24.uf.tistory.com%2Fimage%2F2435D448583111AE1FA24B)

+ /24 는, 전체 32 bit 의 IP 주소 중에, 왼쪽부터 24bit를 의미한다.

일상 생활에서 IP를 비유하자면, 전화번호가 있다.

+ 서울의 경우 02-XXXX-XXXX
+ 인천의 경우 032-XXX-XXXX
+ 동일한 시외 번호를 이용하는 것과 같이, 동일한 네트워크부에 속하면, 동일한 네트워크 주소가 사용된다.
+ 서브넷 마스크는 몇 번째 자리까지가 네트워크 주소(시외번호)인지를 구별하기 위한 표시다.

IP 주소 중 호스트부 비트가

+ 모두 0 = 네트워크 주소
+ 모두 1 = **브로드캐스트(Broadcast) 주소**라고 한다.

> 브로드캐스트주소 = 호스트에 할당해서는 안되는 특별한 주소

+ 브로드캐스트 주소로 보낸 패킷은 같은 네트워크의 모든 호스트에 전달된다.

> `IP 주소가 고갈됐다.` 라는 말을 들었다면, 이는 IPv4 체계는 주소를 32bit 체계로 표현했다고 했는데, 이는 약 43억 개 주소가 있는데, 이 주소체계를 다 사용해서, IP 자릿수를 늘리는 것을 의미한다. 
참고로 IPv6 의 경우는 이를 고려해 128bit 체계이다.

**사설주소 & 공공주소**

IP 주소란 목적지를 식별하기 위한 것이라고 했다.

+ 192.168.~.~
+ 172.16.~.~
+ 10.0.~.~

> 위에, 3가지로 시작하는 IP주소를 많이들 봤을 것이다.
그전에,  만약 다른 곳에 위치한 두 대의 PC가 동일한 IP 주소를 사용한다면, 패킷을 어느 컴퓨터에 전달해야 할지 알 수 없다.

+ 원래는 고유한 IP 주소를 할당해야 하지만, IP 주소도 역시 제한적인 수가 있고, 그래서 인터넷에 사용하는 IP는 특정 조직의 IP주소는 OO이다. 라고 지정해준다.

그래서, 위에 저 3개 IP로 시작하는 주소를 우리는, 가정이나 회사 내에서 사용하는 네트워크, `사설(Private)주소` 라고 한다.

+ 192.168.~.~ 형태가 가정에서 주로 사용되는 IP주소다.

사설주소와 반대 개념이 되는 것이, `공공(Public)주소` 이다.

> 사설 주소는 자유롭게 사용할 수 있어 편리하지만, 인터넷상의 호스트 등과 통신이 불가하다.

+ 즉, 내 PC가 사설 주소밖에 가지고 있지 않다면, 브라우저로 웹사이트를 열람할 순 없을 것이다.

**NAT/ HTTP 프록시**

+ 이를 해결하기 위해 공공주소 & 사설 주소가 모두 할당된 호스트를 준비하고, 사설 주소만 있는 호스트는 해당 호스트를 경우해서 인터넷과 통신하도록 한다.

### 라우팅

> IP 주소를 이용해 대상 서버를 지정할 수 있다.
하지만, 대상 서버가 항상 같은 네트워크부 내에 있지는 않을 것이다.

+ 서로 다른 네트워크부에 있다면, 이 경우에는 최종 목적지에 도착할 때까지 목적지를 알고 있는 라우터에 전송을 부탁한다.

**라우팅 테이블**

+ IP 패킷을 받은 라우터는 해당 IP 패킷의 헤더를 확인해서, 목적지를 확인한다.
+ 이때 사용되는 것이 라우팅 테이블(경로표) 이다.
+ 서버나 라우터는 자신이 알고 있는 목적지 정보를 라우팅 테이블이라 하는 형태로 목록화한다.

**게이트웨이**

+ 서로 다른 외부와 접속하는 네트워크는 게이트웨이라는 라우터가 설치돼 있다.

![](https://i.ytimg.com/vi/ai5bFPVToMU/maxresdefault.jpg)

+ IP를 이용한 전송은 주변을 신뢰해야만 성립되는 것
+ 특히 인터넷 통신에 경우, 자신이 관리하지 않는 네트워크를 다수 경유해야지만 패킷이 상대 서버에 도달한다.
+ 각 라우터는 라우팅테이블을 기반으로 패킷을 전송하기 때문에, 이것이 잘못 작성되어 있으면, 패킷의 목적지가 바뀔 수 있다.

**TTL(Time To Live)**

+ IP패킷이 목적지를 못찾고, 네트워크 사이를 무한순회하는 현상을 제어하기 위해 존재
+ IP 패킷의 생존 시간을 의미
+ 예를 들어, TTL = 64 부터 시작한다면, 라우터 하나 경유할 때마다, TTL 이 -1 씩 차감된다.
+ 끝내 TTL = 0 이 된다면, 패킷 생존 기간이 끝나서, 라우터가 패킷을 파기한다.
+ OS마다 TTL 설정은 다르다.

**체크섬(CheckSum)**

+ IPv4 헤더에는 체크섬이 있다.
+ 이를 통해, 헤더 정보가 파괴된것이 있는지 확인할 수 있다. 헤더 정보에 변경이 있으면 체크섬을 재계산한다.
+ 헤더 내에서 매번 발생하는 경우는, TTL의 경우가 그렇다. 라우터 하나 경유만 해도, TTL이 1씩 차감되니깐 그러하다.


